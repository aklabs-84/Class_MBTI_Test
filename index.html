<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>우리 반 유튜브 채널 MBTI 테스트</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Jua', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 600px;
        }
        .bg-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 2rem;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .input-glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
        }
        .name-input {
            transition: all 0.3s ease;
        }
        .name-input:focus {
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.6);
        }
        .bounce-in {
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        .slide-in {
            animation: slideIn 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .result-animation {
            animation: resultPop 1.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes resultPop {
            0% { transform: scale(0.5) rotate(-5deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(2deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        .typing-effect {
            border-right: 2px solid #667eea;
            animation: typing 2s steps(30) infinite;
        }
        @keyframes typing {
            0%, 50% { border-color: #667eea; }
            51%, 100% { border-color: transparent; }
        }
        .hover-lift {
            transition: all 0.3s ease;
        }
        .hover-lift:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .pulse-ring {
            animation: pulse-ring 2s infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <!-- 오디오 요소들 -->
    <audio id="bgm" loop>
        <source src="bgm.mp3" type="audio/mpeg">
    </audio>
    <audio id="clickSound">
        <source src="click.mp3" type="audio/mpeg">
    </audio>
    <audio id="resultSound">
        <source src="result.mp3" type="audio/mpeg">
    </audio>

    <div class="container mx-auto p-8 bg-card">
        <div id="test-container" class="space-y-6">
            <!-- 첫 페이지 (이름 입력) -->
            <div id="start-screen" class="text-center space-y-8 bounce-in">
                <div class="space-y-4">
                    <h1 class="text-5xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
                        우리 반 유튜브 채널
                    </h1>
                    <h2 class="text-3xl font-bold text-gray-700">MBTI 테스트</h2>
                    <p class="text-gray-600 text-lg typing-effect">
                        내가 만약 우리 반 유튜브 채널 멤버라면? 나의 역할은 무엇일까?
                    </p>
                </div>
                
                <div class="space-y-6 mt-12">
                    <div class="relative">
                        <input 
                            type="text" 
                            id="userName" 
                            placeholder="이름을 입력해주세요" 
                            class="w-full px-6 py-4 text-xl text-center border-2 border-purple-300 rounded-2xl name-input focus:outline-none focus:border-purple-500 bg-white/80"
                            maxlength="10"
                        >
                        <div class="absolute inset-0 rounded-2xl bg-gradient-to-r from-purple-400 to-blue-400 opacity-0 transition-opacity duration-300 pointer-events-none" id="inputGlow"></div>
                    </div>
                    
                    <button id="start-button" class="px-12 py-4 text-xl font-bold text-white bg-gradient-to-r from-purple-500 to-blue-500 rounded-2xl shadow-lg hover-lift pulse-ring transform transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        🚀 테스트 시작하기
                    </button>
                </div>
            </div>
            
            <!-- 퀴즈 화면 -->
            <div id="quiz-screen" class="hidden">
                <div id="quiz-question-container" class="text-center fade-in">
                    <!-- 문제와 보기가 여기에 렌더링됩니다 -->
                </div>
                <div class="w-full h-3 mt-8 bg-gray-200 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-3 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full transition-all duration-500 ease-out"></div>
                </div>
                <div id="progress-text" class="mt-3 text-sm text-right text-gray-600 font-semibold">1/12</div>
            </div>

            <!-- 결과 화면 -->
            <div id="result-screen" class="hidden text-center space-y-6">
                <div class="result-animation">
                    <h2 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-4">
                        🎉 당신의 유형은...
                    </h2>
                    <div id="result-type" class="text-4xl font-extrabold text-purple-700 mb-6 p-4 bg-gradient-to-r from-purple-100 to-blue-100 rounded-2xl"></div>
                </div>
                
                <div id="result-description" class="space-y-4 text-left bg-white/60 p-6 rounded-2xl backdrop-blur-sm">
                    <p id="result-feature" class="text-xl font-semibold text-gray-800 leading-relaxed"></p>
                    <div class="space-y-2 text-gray-700">
                        <p id="result-strengths" class="text-base leading-relaxed"></p>
                        <p id="result-weaknesses" class="text-base leading-relaxed"></p>
                        <p id="result-match" class="text-base leading-relaxed"></p>
                        <p id="result-character" class="text-base leading-relaxed"></p>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8">
                    <button id="copy-button" class="px-8 py-3 font-bold text-purple-600 bg-white border-2 border-purple-500 rounded-2xl shadow-lg hover-lift transition-all duration-300">
                        📋 결과 복사하기
                    </button>
                    <button id="restart-button" class="px-8 py-3 font-bold text-white bg-gradient-to-r from-purple-500 to-blue-500 rounded-2xl shadow-lg hover-lift transition-all duration-300">
                        🔄 다시 테스트하기
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 구글 앱스 스크립트 웹앱 URL (실제 URL로 교체 필요)
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzaTT7djjIp5NAckO7hJZZN4bRhnPXAWvHSMWtL9Y4sFpf0q9106qBN_YdjpPq68yn3Eg/exec';

        document.addEventListener('DOMContentLoaded', () => {
            const quizData = [
                {
                    question: "우리 반 유튜브 채널 첫 회의 시간! '우리 뭐 만들지?' 질문이 나오자마자 나는?",
                    options: [
                        { text: '"야! 내가 기가 막힌 아이디어 떠올렸는데 들어봐!" 하고 흥분하며 떠든다.', value: 'E' },
                        { text: '일단 친구들 얘기부터 조용히 듣다가, 괜찮은 아이디어가 나오면 속으로 \'오...\' 하며 공감한다.', value: 'I' }
                    ],
                    type: 'E-I'
                },
                {
                    question: "'아~ 진짜 찍기 싫어!' 하는 친구를 촬영에 끌어들여야 할 때 나는?",
                    options: [
                        { text: '"걱정 마! 내가 옆에서 다 도와줄게!" 라며 팔짱을 끼고 직접 데리고 간다.', value: 'E' },
                        { text: '"그럼 출연은 안 하고 편집만 할래?" 라며 친구가 편안해할 만한 대안을 제시한다.', value: 'I' }
                    ],
                    type: 'E-I'
                },
                {
                    question: "갑자기 구독자 100만 명을 달성해서 시상식에 가게 된다면?",
                    options: [
                        { text: '카메라와 수많은 팬들 앞에서 "여러분 사랑해요!" 라며 수상 소감을 신나게 외친다.', value: 'E' },
                        { text: '수상대에 올라서는 건 좀 쑥스럽고, 그냥 뒤에서 박수나 치며 즐기고 싶다.', value: 'I' }
                    ],
                    type: 'E-I'
                },
                {
                    question: "우리 반 숏폼 챌린지 영상을 만들 때 나는?",
                    options: [
                        { text: '다른 유튜버가 어떻게 했는지부터 찾아보고 똑같이 따라 해 본다.', value: 'S' },
                        { text: "'이게 과연 될까?' 싶지만, 아무도 안 해본 기발한 동작을 먼저 떠올린다.", value: 'N' }
                    ],
                    type: 'S-N'
                },
                {
                    question: "'이 영상 왜 이리 조회수가 안 나오지?' 고민이 될 때 나는?",
                    options: [
                        { text: '영상 제목, 썸네일, 업로드 시간 등 실제 데이터부터 꼼꼼하게 분석한다.', value: 'S' },
                        { text: "'어쩌면 우리 채널의 미래가 바뀌는 순간일지도 몰라!' 라며 먼 미래부터 상상한다.", value: 'N' }
                    ],
                    type: 'S-N'
                },
                {
                    question: "촬영 직전 장소가 바뀌게 된다면?",
                    options: [
                        { text: '"어떤 장비가 더 필요할까?", "빛은 충분할까?" 등 실질적인 문제를 바로 확인한다.', value: 'S' },
                        { text: '"오! 생각지도 못했는데 더 재미있는 영상이 나오겠네!" 라며 새로운 상황을 흥미롭게 받아들인다.', value: 'N' }
                    ],
                    type: 'S-N'
                },
                {
                    question: "친구의 영상이 편집 과정에서 실수로 날아갔다! 이때 나는?",
                    options: [
                        { text: '"왜 백업을 안 했어? 다음부터는 꼭 백업해." 라며 해결책부터 말해준다.', value: 'T' },
                        { text: '"괜찮아... 얼마나 속상할까..." 라며 친구의 마음을 먼저 위로해 준다.', value: 'F' }
                    ],
                    type: 'T-F'
                },
                {
                    question: '"니가 출연하면 조회수가 안 나올 것 같아" 라는 댓글을 보았다면?',
                    options: [
                        { text: "'음... 내 연기가 부족했나?' 라며 자신의 연기력을 객관적으로 평가한다.", value: 'T' },
                        { text: "'악플은 무시해야지!' 라며 상처받은 마음을 감추고 속상해한다.", value: 'F' }
                    ],
                    type: 'T-F'
                },
                {
                    question: "콘텐츠에 재미를 위해 친구의 비밀이 폭로되는 장면을 넣어야 한다면?",
                    options: [
                        { text: '"재미를 위해서라면 이 정도는 괜찮지!" 라며 논리적으로 설득한다.', value: 'T' },
                        { text: '친구가 상처받을까 봐 "그냥 그 장면은 빼자" 라고 먼저 제안한다.', value: 'F' }
                    ],
                    type: 'T-F'
                },
                {
                    question: "우리 반 유튜브 채널을 시작하기 전, 나는?",
                    options: [
                        { text: '"일단 회의부터 하자! 역할 분담, 주제, 촬영 날짜, 업로드 날짜 다 정해야지!" 라며 계획을 세운다.', value: 'J' },
                        { text: '"뭐부터 할까? 일단 영상 하나 찍어보고 생각해도 될 것 같은데?" 라며 자유롭게 시작한다.', value: 'P' }
                    ],
                    type: 'J-P'
                },
                {
                    question: "촬영 직전, '지금 아이디어가 바뀌었는데...?' 라는 친구의 말에 나는?",
                    options: [
                        { text: '"무슨 소리야! 이미 계획 다 짜놨잖아!" 라며 혼란스러워한다.', value: 'J' },
                        { text: '"그래? 그럼 갑자기 바꿔서 찍는 것도 재미있겠다!" 라며 새로운 상황을 즐긴다.', value: 'P' }
                    ],
                    type: 'J-P'
                },
                {
                    question: "'이번 달 안에 구독자 100명 달성!' 이라는 목표를 정했다면?",
                    options: [
                        { text: '목표를 이루기 위해 매일매일 할 일을 꼼꼼히 체크하며 강박적으로 달려간다.', value: 'J' },
                        { text: "'안 되면 어때!' 라는 마음으로 편하게 생각하고, 될 때까지 즐겁게 영상을 만든다.", value: 'P' }
                    ],
                    type: 'J-P'
                }
            ];

            const results = {
                'ISTJ': {
                    name: '청렴결백한 논리주의자',
                    feature: '책임감 강한 유튜브 채널의 \'총괄 PD\'. 철저한 계획과 꼼꼼한 관리로 채널을 성공으로 이끌어요.',
                    strengths: '강점: 꼼꼼한 편집, 체계적인 일정 관리, 높은 완성도',
                    weaknesses: '약점: 새로운 시도나 즉흥적인 아이디어에 대한 거부감',
                    match: '찰떡궁합: ESFP, ESTP',
                    character: '캐릭터 비유: 계획대로 착착! 무서울 정도로 완벽한 \'마스터 플래너\'.'
                },
                'ISFJ': {
                    name: '용감한 수호자',
                    feature: '팀의 든든한 서포터\'. 조용하지만 팀원들을 묵묵히 챙기며 안정적인 운영을 돕는 없어서는 안 될 존재.',
                    strengths: '강점: 팀원들의 의견 경청, 섬세하고 따뜻한 콘텐츠 기획, 든든한 서포터 역할',
                    weaknesses: '약점: 자신의 의견을 내세우는 것에 어려움',
                    match: '찰떡궁합: ESFP, ESTP',
                    character: '캐릭터 비유: 모두를 챙기는 \'우리 팀 밥도둑\'.'
                },
                'INFJ': {
                    name: '선의의 옹호자',
                    feature: '채널의 정신적 지주\'. 깊은 통찰력으로 채널의 비전을 제시하고, 의미 있는 콘텐츠를 만든다.',
                    strengths: '강점: 창의적인 기획력, 팀원들의 잠재력 발굴, 감동적인 스토리텔링',
                    weaknesses: '약점: 현실적인 어려움에 쉽게 낙담',
                    match: '찰떡궁합: ENFP, ENTP',
                    character: '캐릭터 비유: \'인생의 의미\'를 찾는 철학자.'
                },
                'INTJ': {
                    name: '용의주도한 전략가',
                    feature: '냉철한 전략가\'. 논리적이고 전략적인 분석으로 채널의 성공을 이끌어낸다.',
                    strengths: '강점: 목표 설정, 데이터 기반의 채널 성장 전략, 비판적 사고',
                    weaknesses: '약점: 타인의 감정을 고려하지 않은 냉정한 피드백',
                    match: '찰떡궁합: ENFP, ENTP',
                    character: '캐릭터 비유: 머릿속에 \'성공 방정식\'이 있는 천재.'
                },
                'ISTP': {
                    name: '만능 재주꾼',
                    feature: '금손 엔지니어\'. 뛰어난 기술력으로 편집, 촬영 장비 등을 다루며 채널의 퀄리티를 높인다.',
                    strengths: '강점: 문제 해결 능력, 실제적인 작업 능력, 즉흥적인 상황 대처 능력',
                    weaknesses: '약점: 기획 단계나 회의에 집중하지 못함',
                    match: '찰떡궁합: ESFJ, ESTJ',
                    character: '캐릭터 비유: 모든 것을 고치는 \'맥가이버\'.'
                },
                'ISFP': {
                    name: '호기심 많은 예술가',
                    feature: '자유로운 예술가\'. 자유로운 감성으로 영상미를 더하고, 직관적인 감각으로 영상의 분위기를 살린다.',
                    strengths: '강점: 뛰어난 영상미, 감각적인 편집, 자연스러운 출연',
                    weaknesses: '약점: 정해진 규칙이나 시간 제약에 대한 답답함',
                    match: '찰떡궁합: ESFJ, ESTJ',
                    character: '캐릭터 비유: \'오늘만 사는\' 감성 천재.'
                },
                'INFP': {
                    name: '열정적인 중재자',
                    feature: '팀의 힐링 요정\'. 따뜻한 마음으로 팀원들을 격려하고, 모두가 즐길 수 있는 분위기를 만든다.',
                    strengths: '강점: 긍정적인 에너지, 독특하고 따뜻한 콘텐츠 기획, 팀워크 향상',
                    weaknesses: '약점: 현실적인 문제에 대한 무관심',
                    match: '찰떡궁합: ENTJ, ESTJ',
                    character: '캐릭터 비유: \'감성 충전기\'를 들고 다니는 유튜버.'
                },
                'INTP': {
                    name: '논리적인 사색가',
                    feature: '똑똑한 브레인\'. 복잡한 아이디어를 논리적으로 정리하고, 채널의 방향성을 과학적으로 분석한다.',
                    strengths: '강점: 독창적인 콘텐츠 아이디어, 논리적이고 체계적인 분석, 지적 호기심',
                    weaknesses: '약점: 사회적 상호작용에 어려움',
                    match: '찰떡궁합: ENTJ, ESTJ',
                    character: '캐릭터 비유: \'생각하는 로봇\'처럼 정확한 논리력을 가진 천재.'
                },
                'ESTP': {
                    name: '모험을 즐기는 사업가',
                    feature: '진정한 모험가\'. 직접 몸으로 부딪히며 콘텐츠를 만들고, 재미있는 돌발 상황을 유도한다.',
                    strengths: '강점: 뛰어난 순발력, 즉흥적인 출연 능력, 위기 대처 능력',
                    weaknesses: '약점: 계획을 세우는 것에 어려움',
                    match: '찰떡궁합: ISFJ, ISTJ',
                    character: '캐릭터 비유: \'몸으로 말해요\' 챌린지 1등.'
                },
                'ESFP': {
                    name: '자유로운 영혼의 연예인',
                    feature: '타고난 엔터테이너\'. 채널의 활력소로, 타고난 끼와 재능으로 시청자들을 즐겁게 한다.',
                    strengths: '강점: 뛰어난 표현력, 사람들을 끌어당기는 매력, 유머 감각',
                    weaknesses: '약점: 장기적인 계획을 세우는 것에 어려움',
                    match: '찰떡궁합: ISFJ, ISTJ',
                    character: '캐릭터 비유: \'모두의 사랑\'을 받는 인기 스타.'
                },
                'ENFP': {
                    name: '재기발랄한 활동가',
                    feature: '아이디어 뱅크\'. 새로운 아이디어와 열정으로 채널에 활기를 불어넣고, 시청자와 소통한다.',
                    strengths: '강점: 창의적인 기획력, 뛰어난 소통 능력, 긍정적인 에너지',
                    weaknesses: '약점: 쉽게 싫증을 내고 계획을 바꾸는 경향',
                    match: '찰떡궁합: INFJ, INTJ',
                    character: '캐릭터 비유: \'반짝이는 아이디어\'로 가득 찬 반짝이 폭탄.'
                },
                'ENTP': {
                    name: '뜨거운 논쟁을 즐기는 변론가',
                    feature: '토론의 제왕\'. 논리적인 사고와 기발한 아이디어로 채널의 방향성을 확장시킨다.',
                    strengths: '강점: 통찰력, 분석력, 복잡한 문제 해결 능력',
                    weaknesses: '약점: 세부적인 규칙이나 반복적인 작업에 대한 거부감',
                    match: '찰떡궁합: INFJ, INTJ',
                    character: '캐릭터 비유: \'생각의 틀\'을 깨부수는 브레인.'
                },
                'ESTJ': {
                    name: '엄격한 관리자',
                    feature: '철두철미한 리더\'. 철저한 계획과 책임감으로 채널의 운영을 총괄하며 목표를 달성한다.',
                    strengths: '강점: 효율적인 일정 관리, 체계적인 팀원 관리, 명확한 역할 분담',
                    weaknesses: '약점: 융통성이 부족하고 고집이 강함',
                    match: '찰떡궁합: INFP, INTP',
                    character: '캐릭터 비유: \'칼퇴\'를 꿈꾸는 완벽주의자.'
                },
                'ESFJ': {
                    name: '사교적인 외교관',
                    feature: '팀의 소금 같은 존재\'. 팀원들 사이의 갈등을 중재하고, 긍정적인 분위기를 조성한다.',
                    strengths: '강점: 뛰어난 공감 능력, 팀워크 향상, 사람들의 마음을 사로잡는 콘텐츠 기획',
                    weaknesses: '약점: 비판적인 피드백에 민감함',
                    match: '찰떡궁합: ISFP, ISTP',
                    character: '캐릭터 비유: \'우리 팀의 엄마\' 역할을 하는 따뜻한 리더.'
                },
                'ENFJ': {
                    name: '정의로운 사회운동가',
                    feature: '동기 부여의 신\'. 사람들에게 영감을 주는 콘텐츠를 기획하고, 팀원들을 격려하며 함께 성장한다.',
                    strengths: '강점: 뛰어난 리더십, 사람을 끄는 매력, 의미 있는 콘텐츠 기획',
                    weaknesses: '약점: 타인의 평가에 지나치게 신경 쓰는 경향',
                    match: '찰떡궁합: INFP, ISFP',
                    character: '캐릭터 비유: \'영감을 주는\' 리더.'
                },
                'ENTJ': {
                    name: '대담한 통솔자',
                    feature: '카리스마 CEO\'. 목표 달성을 위해 팀을 이끌고, 효율적인 시스템을 구축한다.',
                    strengths: '강점: 뛰어난 리더십, 명확한 비전 제시, 강력한 추진력',
                    weaknesses: '약점: 다른 사람의 의견을 무시하고 독단적으로 결정하는 경향',
                    match: '찰떡궁합: INFP, INTP',
                    character: '캐릭터 비유: \'내가 바로 유튜브 왕\'이라고 외치는 통솔자.'
                }
            };
            
            let currentQuestionIndex = 0;
            let mbtiCounts = { 'E': 0, 'I': 0, 'S': 0, 'N': 0, 'T': 0, 'F': 0, 'J': 0, 'P': 0 };
            let userName = '';

            const startScreen = document.getElementById('start-screen');
            const quizScreen = document.getElementById('quiz-screen');
            const resultScreen = document.getElementById('result-screen');
            const startButton = document.getElementById('start-button');
            const restartButton = document.getElementById('restart-button');
            const copyButton = document.getElementById('copy-button');
            const quizQuestionContainer = document.getElementById('quiz-question-container');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const resultType = document.getElementById('result-type');
            const resultFeature = document.getElementById('result-feature');
            const resultStrengths = document.getElementById('result-strengths');
            const resultWeaknesses = document.getElementById('result-weaknesses');
            const resultMatch = document.getElementById('result-match');
            const resultCharacter = document.getElementById('result-character');
            const userNameInput = document.getElementById('userName');

            // 오디오 요소들
            const bgm = document.getElementById('bgm');
            const clickSound = document.getElementById('clickSound');
            const resultSound = document.getElementById('resultSound');

            // 이름 입력 필드 이벤트
            userNameInput.addEventListener('input', function() {
                const name = this.value.trim();
                startButton.disabled = name.length === 0;
                
                if (name.length > 0) {
                    startButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    startButton.classList.add('pulse-ring');
                } else {
                    startButton.classList.add('opacity-50', 'cursor-not-allowed');
                    startButton.classList.remove('pulse-ring');
                }
            });

            userNameInput.addEventListener('focus', function() {
                document.getElementById('inputGlow').style.opacity = '0.2';
            });

            userNameInput.addEventListener('blur', function() {
                document.getElementById('inputGlow').style.opacity = '0';
            });

            // 구글 스프레드시트 저장 함수
            async function saveToSpreadsheet(mbtiType, resultData) {
                try {
                    const currentDate = new Date();
                    const formattedDate = currentDate.toLocaleString('ko-KR', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });

                    const data = {
                        timestamp: formattedDate,
                        name: userName,
                        resultTitle: `${mbtiType} (${resultData.name})`,
                        resultContent: resultData.feature,
                        score: `E:${mbtiCounts.E} I:${mbtiCounts.I} S:${mbtiCounts.S} N:${mbtiCounts.N} T:${mbtiCounts.T} F:${mbtiCounts.F} J:${mbtiCounts.J} P:${mbtiCounts.P}`
                    };

                    const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data),
                        mode: 'no-cors'
                    });

                    console.log('결과가 스프레드시트에 저장되었습니다.');

                } catch (error) {
                    console.error('스프레드시트 저장 중 오류 발생:', error);
                }
            }

            function showScreen(screenId) {
                startScreen.classList.add('hidden');
                quizScreen.classList.add('hidden');
                resultScreen.classList.add('hidden');
                document.getElementById(screenId).classList.remove('hidden');
            }

            function renderQuestion() {
                const questionData = quizData[currentQuestionIndex];
                quizQuestionContainer.innerHTML = `
                    <div class="p-8 bg-gradient-to-br from-purple-100 to-blue-100 rounded-2xl shadow-inner slide-in">
                        <p class="text-3xl font-semibold text-gray-800 leading-relaxed">${questionData.question}</p>
                    </div>
                    <div class="mt-8 space-y-4">
                        ${questionData.options.map((option, index) => `
                            <button class="w-full p-6 text-left text-xl bg-white/80 rounded-xl shadow-md hover:bg-purple-50 transition-all duration-300 option-button hover-lift border-2 border-transparent hover:border-purple-300" data-value="${option.value}">
                                <span class="text-gray-800 leading-relaxed">${option.text}</span>
                            </button>
                        `).join('')}
                    </div>
                `;
                
                document.querySelectorAll('.option-button').forEach(button => {
                    button.addEventListener('click', handleOptionClick);
                });

                progressText.textContent = `${currentQuestionIndex + 1}/12`;
                progressBar.style.width = `${((currentQuestionIndex + 1) / 12) * 100}%`;
            }

            function handleOptionClick(event) {
                // 클릭 사운드 재생
                clickSound.currentTime = 0;
                clickSound.play().catch(e => console.log('Click sound failed:', e));

                const value = event.target.dataset.value;
                mbtiCounts[value]++;
                
                currentQuestionIndex++;
                if (currentQuestionIndex < quizData.length) {
                    setTimeout(() => {
                        renderQuestion();
                    }, 200);
                } else {
                    setTimeout(() => {
                        showResult();
                    }, 500);
                }
            }

            async function showResult() {
                // BGM 정지
                bgm.pause();
                
                // 결과 사운드 재생
                resultSound.currentTime = 0;
                resultSound.play().catch(e => console.log('Result sound failed:', e));

                let mbtiType = '';
                mbtiType += mbtiCounts['E'] > mbtiCounts['I'] ? 'E' : 'I';
                mbtiType += mbtiCounts['S'] > mbtiCounts['N'] ? 'S' : 'N';
                mbtiType += mbtiCounts['T'] > mbtiCounts['F'] ? 'T' : 'F';
                mbtiType += mbtiCounts['J'] > mbtiCounts['P'] ? 'J' : 'P';
                
                const resultData = results[mbtiType];
                
                resultType.textContent = `${mbtiType} (${resultData.name})`;
                resultFeature.textContent = `특징: ${resultData.feature}`;
                resultStrengths.textContent = resultData.strengths;
                resultWeaknesses.textContent = resultData.weaknesses;
                resultMatch.textContent = resultData.match;
                resultCharacter.textContent = resultData.character;

                showScreen('result-screen');
                
                // 구글 스프레드시트에 저장
                await saveToSpreadsheet(mbtiType, resultData);
            }

            function restartTest() {
                currentQuestionIndex = 0;
                mbtiCounts = { 'E': 0, 'I': 0, 'S': 0, 'N': 0, 'T': 0, 'F': 0, 'J': 0, 'P': 0 };
                userName = '';
                userNameInput.value = '';
                startButton.disabled = true;
                startButton.classList.add('opacity-50', 'cursor-not-allowed');
                startButton.classList.remove('pulse-ring');
                progressBar.style.width = '0%';
                
                // BGM 정지
                bgm.pause();
                bgm.currentTime = 0;
                
                showScreen('start-screen');
            }

            function copyResult() {
                const mbtiType = resultType.textContent;
                const feature = resultFeature.textContent;
                const strengths = resultStrengths.textContent;
                const weaknesses = resultWeaknesses.textContent;
                const match = resultMatch.textContent;
                const character = resultCharacter.textContent;

                const resultText = `🎉 ${userName}님의 MBTI 테스트 결과 🎉

${mbtiType}

${feature}

${strengths}
${weaknesses}
${match}
${character}

📱 우리 반 유튜브 채널 MBTI 테스트에서 확인했어요!`;

                navigator.clipboard.writeText(resultText).then(() => {
                    copyButton.innerHTML = '✅ 복사 완료!';
                    setTimeout(() => {
                        copyButton.innerHTML = '📋 결과 복사하기';
                    }, 2000);
                }).catch(err => {
                    console.error('복사 실패:', err);
                    alert('복사에 실패했습니다. 브라우저가 복사 기능을 지원하지 않습니다.');
                });
            }

            startButton.addEventListener('click', () => {
                userName = userNameInput.value.trim();
                if (userName) {
                    // BGM 재생
                    bgm.currentTime = 0;
                    bgm.play().catch(e => console.log('BGM failed:', e));
                    
                    showScreen('quiz-screen');
                    setTimeout(() => {
                        renderQuestion();
                    }, 300);
                }
            });

            restartButton.addEventListener('click', restartTest);
            copyButton.addEventListener('click', copyResult);

            // Enter 키로 시작하기
            userNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !startButton.disabled) {
                    startButton.click();
                }
            });
        });
    </script>
</body>
</html>
